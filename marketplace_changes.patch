*** Begin Patch
*** Add File: infra/main.json
+{
+  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
+  "contentVersion": "1.0.0.0",
+  "parameters": {
+    "location": {
+      "type": "string",
+      "defaultValue": "[resourceGroup().location]",
+      "metadata": {
+        "description": "Location for resources"
+      }
+    },
+    "functionAppName": {
+      "type": "string",
+      "metadata": {
+        "description": "Function App name"
+      }
+    },
+    "storageAccountName": {
+      "type": "string",
+      "metadata": {
+        "description": "Storage account for function and results"
+      }
+    },
+    "appServicePlanName": {
+      "type": "string",
+      "metadata": {
+        "description": "App Service plan name"
+      }
+    },
+    "containerName": {
+      "type": "string",
+      "defaultValue": "drawfunc",
+      "metadata": {
+        "description": "Blob container name for output storage"
+      }
+    },
+    "_artifactsLocation": {
+      "type": "string",
+      "metadata": {
+        "description": "Base URI where all artifacts for the deployment are staged."
+      },
+      "defaultValue": "[deployment().properties.templateLink.uri]"
+    },
+    "_artifactsLocationSasToken": {
+      "type": "securestring",
+      "metadata": {
+        "description": "SAS token required to access the artifacts."
+      },
+      "defaultValue": ""
+    }
+  },
+  "variables": {
+    "functionZipUri": "[uri(parameters('_artifactsLocation'), 'artifacts/function.zip', parameters('_artifactsLocationSasToken'))]"
+  },
+  "resources": [
+    {
+      "type": "Microsoft.Storage/storageAccounts",
+      "apiVersion": "2022-09-01",
+      "name": "[parameters('storageAccountName')]",
+      "location": "[parameters('location')]",
+      "sku": { "name": "Standard_LRS" },
+      "kind": "StorageV2",
+      "properties": {
+        "minimumTlsVersion": "TLS1_2",
+        "allowBlobPublicAccess": false
+      }
+    },
+    {
+      "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
+      "apiVersion": "2022-09-01",
+      "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('containerName'))]",
+      "properties": { "publicAccess": "None" },
+      "dependsOn": [
+        "[parameters('storageAccountName')]"
+      ]
+    },
+    {
+      "type": "Microsoft.Web/serverfarms",
+      "apiVersion": "2022-03-01",
+      "name": "[parameters('appServicePlanName')]",
+      "location": "[parameters('location')]",
+      "sku": {
+        "name": "EP1",
+        "tier": "ElasticPremium",
+        "capacity": 1
+      },
+      "kind": "linux",
+      "properties": {
+        "reserved": true,
+        "perSiteScaling": false,
+        "maximumElasticWorkerCount": 1
+      }
+    },
+    {
+      "type": "Microsoft.Web/sites",
+      "apiVersion": "2023-01-01",
+      "name": "[parameters('functionAppName')]",
+      "location": "[parameters('location')]",
+      "kind": "functionapp,linux",
+      "identity": { "type": "SystemAssigned" },
+      "properties": {
+        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlanName'))]",
+        "siteConfig": {
+          "appSettings": [
+            { "name": "FUNCTIONS_WORKER_RUNTIME", "value": "python" },
+            { "name": "FUNCTIONS_EXTENSION_VERSION", "value": "~4" },
+            { "name": "WEBSITE_RUN_FROM_PACKAGE", "value": "[variables('functionZipUri')]" },
+            { "name": "DRAWING_STORAGE_URL", "value": "[format('https://{0}.blob.core.windows.net', parameters('storageAccountName'))]" },
+            { "name": "DRAWING_CONTAINER_NAME", "value": "[parameters('containerName')]" },
+            { "name": "AzureWebJobsStorage__accountName", "value": "[parameters('storageAccountName')]" }
+          ],
+          "linuxFxVersion": "Python|3.10"
+        },
+        "httpsOnly": true
+      },
+      "dependsOn": [
+        "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlanName'))]",
+        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
+      ]
+    },
+    {
+      "type": "Microsoft.Web/sites/config",
+      "apiVersion": "2023-01-01",
+      "name": "[format('{0}/web', parameters('functionAppName'))]",
+      "properties": {
+        "cors": {
+          "allowedOrigins": [
+            "https://portal.azure.com"
+          ],
+          "supportCredentials": true
+        }
+      },
+      "dependsOn": [
+        "[resourceId('Microsoft.Web/sites', parameters('functionAppName'))]"
+      ]
+    },
+    {
+      "type": "Microsoft.Authorization/roleAssignments",
+      "apiVersion": "2020-04-01-preview",
+      "name": "[guid(parameters('functionAppName'), parameters('storageAccountName'))]",
+      "scope": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]",
+      "properties": {
+        "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('functionAppName')), '2023-01-01', 'full').identity.principalId]",
+        "roleDefinitionId": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')]",
+        "principalType": "ServicePrincipal"
+      },
+      "dependsOn": [
+        "[resourceId('Microsoft.Web/sites', parameters('functionAppName'))]"
+      ]
+    }
+  ],
+  "outputs": {
+    "functionAppEndpoint": {
+      "type": "string",
+      "value": "[format('https://{0}', reference(resourceId('Microsoft.Web/sites', parameters('functionAppName'))).defaultHostName)]"
+    },
+    "location": {
+      "type": "string",
+      "value": "[parameters('location')]"
+    }
+  }
+}
*** End Patch

*** Begin Patch
*** Add File: createUiDefinition.json
+{
+  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUiDefinition.MultiVm.json#",
+  "version": "0.1.2",
+  "handler": "Microsoft.Azure.CreateUIDef",
+  "parameters": {
+    "basics": [
+      {
+        "name": "functionAppName",
+        "type": "Microsoft.Common.TextBox",
+        "label": "Function App Name",
+        "toolTip": "Enter a globally unique name for the Azure Function App."
+      },
+      {
+        "name": "storageAccountName",
+        "type": "Microsoft.Common.TextBox",
+        "label": "Storage Account Name",
+        "toolTip": "Name of the storage account to hold the code and results."
+      },
+      {
+        "name": "appServicePlanName",
+        "type": "Microsoft.Common.TextBox",
+        "label": "App Service Plan Name",
+        "toolTip": "Name of the Elastic Premium plan for the function."
+      },
+      {
+        "name": "containerName",
+        "type": "Microsoft.Common.TextBox",
+        "defaultValue": "drawfunc",
+        "label": "Blob Container Name",
+        "toolTip": "Name of the blob container where diagrams will be stored."
+      },
+      {
+        "name": "location",
+        "type": "Microsoft.Common.Location",
+        "label": "Region",
+        "toolTip": "Select the Azure region for deployment."
+      }
+    ]
+  },
+  "outputs": {
+    "functionAppName": "[basics('functionAppName')]",
+    "storageAccountName": "[basics('storageAccountName')]",
+    "appServicePlanName": "[basics('appServicePlanName')]",
+    "containerName": "[basics('containerName')]",
+    "location": "[basics('location')]"
+  }
+}
*** End Patch

*** Begin Patch
*** Add File: artifacts/.gitkeep
+This directory should contain the zipped Azure Function code (function.zip) that the ARM template references via `_artifactsLocation`.
*** End Patch
